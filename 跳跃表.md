## 跳表在 Redis 的用途
跳表（zskiplist）是 Sorted Set（有序集合，Zset）的一种底层实现。Zset 有两个底层结构：
- ziplist / listpack（紧凑列表），旧版本是 ziplist，从 Redis 7 开始用 listpack 替代。当元素少（zset-max-listpack-entries，默认 128）且成员字符串较短（zset-max-listpack-value，默认 64字节），会用这种节省内存的紧凑结构
- skiplist + dict（跳表 + 哈希表），


<img width="1074" height="101" alt="image" src="https://github.com/user-attachments/assets/deba09c4-5bac-4381-9003-753643dfc4e4" />


## 源码
> src/server.h
```c
/* ZSETs use a specialized version of Skiplists */
typedef struct zskiplistNode {
    sds ele;                    // 成员值（字符串，SDS）
    double score;               // 分值（排序主键）
    struct zskiplistNode *backward; // 同层双向：指向前一个节点（level 1 的后退指针）
    struct zskiplistLevel {     // 多层“前进指针”+ span
        struct zskiplistNode *forward; // 这一层的下一个节点
        unsigned long span;            // 从当前节点到 forward 的“跨度”（用于 O(logN) 计 rank）
    } level[]; // 柔性数组：实际分配 level 个
} zskiplistNode;
```
要点：
- 排序规则：先按 score 升序；score 相等时按 ele 的字典序升序，保证全序一致性。
- span 的作用：维护“走到下一个前进节点跨过了多少个底层节点”，配合多层前进，支持 按排名定位(O(logN))
<br>

```c
typedef struct zskiplist {
    struct zskiplistNode *header, *tail; // 头/尾；header 是带最大层数的哨兵
    unsigned long length;                 // 节点总数（不含 header）
    int level;                            // 当前最高层数（>=1 && <= ZSKIPLIST_MAXLEVEL）
} zskiplist;
```
要点：
- header 不存数据，仅提供最多层的起跳位。
- level 是全表当前“最高层数”，插入/删除时会动态上升或收缩。
<br>
```c
typedef struct zset {
    dict *dict;
    zskiplist *zsl;
} zset;
```
