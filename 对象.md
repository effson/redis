Redis 用到的所有主要数据结构,比如<mark>**简单动态字符串(SDS)、双端链表、字典、压缩列表、整数集合**</mark>等等。<br>
 Redis 并没有直接使用这些数据结构来实现键值对数据库,而是基于这些数据结构创建了一个对象系统,这个系统包含<mark>**字符串对象、列表对象、哈希对象、集合对象和有序集合对象**</mark>这五种类型的对象,每种对象都用到了至少一种前面的数据结构。<br>
 
**源码位置** ：src/t_string.c t_list.c t_hash.c t_set.c t_zset.c<br>

redisObject结构体定义在src/server.h
```c
struct redisObject {
    unsigned type:4;
    unsigned encoding:4;
    unsigned lru:LRU_BITS; /* LRU time (relative to global lru_clock) or
                            * LFU data (least significant 8 bits frequency
                            * and most significant 16 bits access time). */
    int refcount;
    void *ptr;
};
```

## String（字符串对象）
### 常见编码
<mark>**int、embstr、raw**</mark>

#### int
当字符串值可以被解释为64位有符号整数时，Redis会采用int编码:
- 直接将整数值存储在redisObject结构体中，不需要额外分配内存空间存储字符串
- 最节省内存的编码方式
- 存储的字符串是整数形式（例如，SET mykey "123"），且在64位整数的表示范围内，就会使用int编码
- 对这个值执行非整数操作（比如APPEND），或将其修改成无法用整数表示的值，Redis会将编码转换为raw

#### embstr (Embedded String)
嵌入式字符串，用于存储长度较短的字符串
- redisObject结构体和字符串数据（SDS，Simple Dynamic String）被分配在同一块连续的内存空间中
- 减少内存分配次数： 创建键值对时，只需要进行一次内存分配调用（malloc）
- 更好的缓存局部性： 因为对象头和字符串数据是紧邻的，CPU缓存可以更好地命中，从而提高访问速度
- embstr的长度硬性上限通常是44字节

```css
+---------------+---------------------+
| redisObject   | SDS (with data)     |
| (meta data)   |                     |
+---------------+---------------------+
```
#### raw
- raw编码用于存储长度较长的字符串
- redisObject结构体和字符串数据（SDS）是分开独立分配内存的，创建或修改需进行两次malloc
- 当字符串长度大于44字节时，会采用raw编码
```css
+---------------+
| redisObject   |  ->  +------------+
| (meta data)   |      | SDS header |
| +-----------+ |      | (len, free)|
| | data_ptr  | |      +------------+
| +-----------+ |      | String Data |
+---------------+      +-------------+
```


####  为什么44字节是分界线
- redisObject 结构体：type:4bits  encoding:4bits lru:24bits refcount:4字节 *ptr:8字节
- SDS (Simple Dynamic String) 结构体：len:1字节 alloc:1字节 flags:1字节 \0 结束符:1字节
- 两部分20 字节，大多数现代CPU的缓存行Cache Line大小都是64字节
- CPU为了提高数据访问速度，会从主内存（RAM）中读取一整块数据到它自己的高速缓存（Cache）中。这一整块数据的最小单位就叫做缓存行（Cache Line），当CPU需要访问一个变量时，它不是只加载那个变量，而是会把包含这个变量的整个64字节缓存行都加载进来
### 典型命令
**SET/GET/INCR/APPEND/GETRANGE** <br>
详见 string.md

## List（列表对象）


## Hash（哈希对象）


## Set（集合对象）


## Sorted Set（有序集合对象，Zset）
